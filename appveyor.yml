# We have to disable the `build` command explicitly otherwise the default is
# MSBuild which assumes this is a Visual Studio project. Python source/binary
# wheels a Windows .exe are generated below in `install`.
build: false

environment:
  matrix:
    - PYTHON: "C:\\Python36-x64"
    - PYTHON: "C:\\Python37-x64"
    - PYTHON: "C:\\Python38-x64"

install:
  - "SET PATH=%PYTHON%;%PYTHON%\\Scripts;%PATH%"
  - "python --version"
  - "python -m pip install --upgrade pip"
  - "python -m pip install -r dist/requirements_windows.txt"
  - "python -m pip install --upgrade setuptools wheel pyinstaller"
  - "git fetch --depth=1 https://github.com/Breakthrough/PySceneDetect.git refs/heads/resources:refs/remotes/origin/resources"
  - "git checkout refs/remotes/origin/resources -- tests/resources/"
  - "git checkout refs/remotes/origin/resources -- dist/"
  - "python setup.py sdist bdist_wheel"
  - "pyinstaller dist/scenedetect.spec"
  - "7z a scenedetect-win64.zip dist/scenedetect/*"

test_script:
  - "pytest"
  - "cd dist/scenedetect"
  - "scenedetect.exe version"
  - "scenedetect.exe -i ../../tests/resources/testvideo.mp4 -b opencv detect-content"
  - "scenedetect.exe -i ../../tests/resources/testvideo.mp4 -b pyav detect-content"

artifacts:
  - path: scenedetect-win64.zip
    name: PySceneDetect-win64_portable
  - path: dist/*.tar.gz
    name: PySceneDetect-sdist
  - path: dist/*.whl
    name: PySceneDetect-bdist_wheel
